{extend name="base" /}
{block name="style"}
<style>
#mkform{display: flex;display:-webkit-flex;flex-direction: row;}
.fbox{height:100%;padding: 5px;}
.fbox:nth-child(1){width:40%;border-right: 1px solid #ddd;}
.fbox:nth-child(2){width:60%;}
.fbox h2{height: 50px;}
</style>
{/block}
{block name="pageBody"}
    <!--tab标签-->
    <div class="layui-tab layui-tab-brief">
        <ul class="layui-tab-title">
            <li class=""><a href="{:url('index')}">模型管理</a></li>
            <li class=""><a href="{:url('add')}">添加模型</a></li>
            <li><a href="{:url('mkform',['id'=>$r.id])}">模型表单</a></li>
            <li class="layui-this">验证规则</li>
        </ul>
        <div class="layui-tab-content">
            <form action="" method="post" class="ajax-form layui-form" id="f1">
              <input type="hidden" name="id" value="{$r.id}">
                <div id="mkform">
                   <div class="fbox">
                    <h2 align="center">验证规则指定</h2>

<div class="layui-collapse">

{volist name="cols" id="v"}
  <div class="layui-colla-item">
    <h2 class="layui-colla-title">{$v.comment}</h2>
    <div class="layui-colla-content layui-show">
      {volist name="rules" id="gz"}
        <input type="checkbox" name="rule[{$v.name}][]" title="{$gz.name}" value="{$gz.id}" lay-skin="primary" lay-filter="selectRule"{if isset($colrule[$v.name]) && in_array($gz.id,$colrule[$v.name])} checked {/if}>
      {/volist}
    </div>
  </div>
{/volist}

</div>


                   </div>
                   <div class="fbox">
                   	<h2 align="center">表单预览</h2>



<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
  <ul class="layui-tab-title">
    <li class="layui-this">基本属性</li>
    <li>用户管理</li>
    <li>权限分配</li>
    <li>商品管理</li>
    <li>订单管理</li>
  </ul>
  <div class="layui-tab-content">
    <div class="layui-tab-item layui-show">{$form|raw}</div>
    <div class="layui-tab-item">内容2</div>
    <div class="layui-tab-item">内容3</div>
    <div class="layui-tab-item">内容4</div>
    <div class="layui-tab-item">内容5</div>
  </div>
</div> 




<fieldset class="layui-elem-field">
    <legend>说明</legend>
    <div class="layui-field-box">
        <p>此表单仅供预览！</p>
    </div>
</fieldset>

                   </div>
                </div>
            </form>
        </div>
    </div>
{/block}
{block name="script"}
<script>
	$("#mkform").height($(".layui-body").height()-90);
	{//载入编辑器}
	{if isset($editor)}
        CKEDITOR.replace('content',{
            customConfig : '__STATIC__/src/ckeditor/ypconfig.js?v={:time()}'
        });    
	{/if}

form.on('checkbox(selectRule)', function(data){
  var postData=$("#f1").serialize();
  $.ajax({
    url: '{:url("updateRule")}',
    type: 'POST',
    dataType: 'json',
    data: postData,
  })
  .done(function(res) {
    console.log("success");
  })
  .fail(function() {
    console.log("error");
  })
  .always(function() {
    console.log("complete");
  });
  
  console.log(data);
  console.log(data.elem); //得到checkbox原始DOM对象
  console.log(data.elem.checked); //是否被选中，true或者false
  console.log(data.value); //复选框value值，也可以通过data.elem.value得到
  console.log(data.othis); //得到美化后的DOM对象
}); 
</script>
{/block}