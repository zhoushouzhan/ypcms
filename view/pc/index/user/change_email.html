{extend name="layout"}
{block name="pagetitle"}设置新邮箱{/block}
{block name="main"}
<div class="ad layui-main"></div>
<div class="userpage layui-main">
    <div class="user-left">
        {include file="user/menu" /}
    </div>
    <div class="user-main">
        <div class="layui-tab layui-tab-brief">
            <ul class="layui-tab-title">
                <li class="layui-this">设置新邮箱</li>
            </ul>
            <div class="layui-tab-content">
                <form class="layui-form layui-form-pane" action="{:url('index/user/changeEmail')}" method="post">
                    <div class="layui-form-item">
                        <label class="layui-form-label">新邮箱</label>
                        <div class="layui-input-inline">
                            <input type="text" name="newEmail" class="layui-input" lay-verify="email" maxlength="100">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">验证码</label>
                        <div class="layui-input-inline">
                            <input type="text" name="checkCode" class="layui-input" lay-verify="number" maxlength="6">
                        </div>
                        <div class="layui-input-inline">
                            <button type="button" class="layui-btn layui-bg-black changeCode" data-url="{:url('index/user/changeCode')}">邮箱验证码</button>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-input-block">
                             <button type="button" class="layui-btn layui-btn-danger" lay-submit lay-filter="*">立即提交</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{/block}
{block name="script"}
<script>
//发送验证码
$("body").on('click','.changeCode',function(event) {
	/* Act on the event */
	var that=$(this);
	var url=$(this).data('url');
	var newEmail=$("input[name='newEmail']").val();
	if(!isEmail(newEmail)){
		layer.msg('邮箱格式错误',{icon:2});
		return false;
	}
	$.post(url, {email:newEmail}, function(data, textStatus, xhr) {
		if(data.code==1){
			layer.msg(data.msg,{icon:1});
			daojishi(that);
		}else{
			layer.msg(data.msg,{icon:2});
		}
	},'json');
});
</script>
{/block}